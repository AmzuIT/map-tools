<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Document</title>
</head>
<style>
  html, body, #mymap {
    height: 100%;
    margin: 0px;
    padding: 0px;
  }

  #mymap {
    width: 800px;
    height: 500px;
  }

</style>
<body>

<h4><a href="#" class="update-crossfilter">Update Marker by using Crossfilter</a></h4>
<h4><a href="#" class="update-reference">Update Marker by using it's own reference</a></h4>
<h4><a href="#" class="update-reference-location">Update Marker to another location</a></h4>

<script src="../node_modules/crossfilter/crossfilter.js"></script>
<script src="../node_modules/jquery/dist/jquery.js"></script>
<script src="../dist/gmplus.js"></script>

<script>
  var markers = crossfilter([]);
  var cityName = markers.dimension(function(d) { return d.cityName; });
  var positions = [{lat: 41.3833, lng:2.1833}, {lat: 42.263177, lng: 3.178188}];

  var map = new GMP({
    id: 'mymap',
    lat: 41.3833,
    lng: 2.1833,
    crossfilter: markers
  }, function (err, instance) {
    if (!err) {
      addMarker();
    }
  });

  var markerInstance;

  function addMarker() {
    markerInstance = map.addMarker({
      lat: 41.3833,
      lng: 2.1833,
      title: 'Barcelona',
      data: {
        cityName: 'barcelona'
      }
    });
  }

  $(function() {
    $('.update-crossfilter').click(function(e) {
      var marker = cityName.filterExact('barcelona').top(1);
      map.updateMarker(marker, {move: map.drop});
      e.preventDefault();
    });

    $('.update-reference').click(function(e) {
      map.updateMarker([markerInstance], {move: map.drop});
      e.preventDefault();
    });


    var toggle = false;
    $('.update-reference-location').click(function(e) {
      map.updateMarker([markerInstance], positions[+!toggle]);
      toggle = !toggle;
      e.preventDefault();
    });

  });

</script>
<div id="mymap"></div>
</body>
</html>
